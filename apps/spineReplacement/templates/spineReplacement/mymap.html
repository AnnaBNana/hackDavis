<!DOCTYPE html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

    <script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>



  </head>
  <body>

    <div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

  </body>
  <script type="text/javascript">

var data_seed = {"hospitals": [{"hospital_lat": "37.7741", "hospital_long": "-122.4540", "hospital_name": "ST. MARY'S MEDICAL CENTER, SAN FRANCISCO", "avg_cost": 40000.0, "instances": [{"procedure_name": "spine replacement", "hospital_lat": "37.7741", "hospital_long": "-122.4540", "hospital_name": "ST. MARY'S MEDICAL CENTER, SAN FRANCISCO", "instance_cost": "30000.00", "id": 1}, {"procedure_name": "spine replacement", "hospital_lat": "37.7741", "hospital_long": "-122.4540", "hospital_name": "ST. MARY'S MEDICAL CENTER, SAN FRANCISCO", "instance_cost": "50000.00", "id": 2}, {"procedure_name": "spine replacement", "hospital_lat": "37.7741", "hospital_long": "-122.4540", "hospital_name": "ST. MARY'S MEDICAL CENTER, SAN FRANCISCO", "instance_cost": "40000.00", "id": 3}], "id": 1}, {"hospital_lat": "37.7823", "hospital_long": "-122.4430", "hospital_name": "KAISER FND HOSP - SAN FRANCISCO", "avg_cost": 60000.0, "instances": [{"procedure_name": "spine replacement", "hospital_lat": "37.7823", "hospital_long": "-122.4430", "hospital_name": "KAISER FND HOSP - SAN FRANCISCO", "instance_cost": "60000.00", "id": 4}], "id": 2}, {"hospital_lat": "37.7744", "hospital_long": "-122.4260", "hospital_name": "LAGUNA HONDA HOSPITAL AND REHABILITATION CENTER", "avg_cost": 38500.0, "instances": [{"procedure_name": "spine replacement", "hospital_lat": "37.7744", "hospital_long": "-122.4260", "hospital_name": "LAGUNA HONDA HOSPITAL AND REHABILITATION CENTER", "instance_cost": "35000.00", "id": 5}, {"procedure_name": "spine replacement", "hospital_lat": "37.7744", "hospital_long": "-122.4260", "hospital_name": "LAGUNA HONDA HOSPITAL AND REHABILITATION CENTER", "instance_cost": "42000.00", "id": 8}], "id": 3}, {"hospital_lat": "37.7687", "hospital_long": "-122.4350", "hospital_name": "CALIFORNIA PACIFIC MED CTR-DAVIES CAMPUS", "avg_cost": 37000.0, "instances": [{"procedure_name": "spine replacement", "hospital_lat": "37.7687", "hospital_long": "-122.4350", "hospital_name": "CALIFORNIA PACIFIC MED CTR-DAVIES CAMPUS", "instance_cost": "36000.00", "id": 6}, {"procedure_name": "spine replacement", "hospital_lat": "37.7687", "hospital_long": "-122.4350", "hospital_name": "CALIFORNIA PACIFIC MED CTR-DAVIES CAMPUS", "instance_cost": "38000.00", "id": 7}], "id": 4}, {"hospital_lat": "37.7631", "hospital_long": "-122.4580", "hospital_name": "UCSF MEDICAL CENTER", "avg_cost": 41000.0, "instances": [{"procedure_name": "spine replacement", "hospital_lat": "37.7631", "hospital_long": "-122.4580", "hospital_name": "UCSF MEDICAL CENTER", "instance_cost": "40000.00", "id": 9}, {"procedure_name": "spine replacement", "hospital_lat": "37.7631", "hospital_long": "-122.4580", "hospital_name": "UCSF MEDICAL CENTER", "instance_cost": "42000.00", "id": 10}], "id": 7}, {"hospital_lat": "37.7955", "hospital_long": "-122.4090", "hospital_name": "CHINESE HOSPITAL", "avg_cost": 25000.0, "instances": [{"procedure_name": "spine replacement", "hospital_lat": "37.7955", "hospital_long": "-122.4090", "hospital_name": "CHINESE HOSPITAL", "instance_cost": "25000.00", "id": 11}], "id": 10}, {"hospital_lat": "37.7493", "hospital_long": "-122.4570", "hospital_name": "ST. FRANCIS MEMORIAL HOSPITAL", "avg_cost": 43250.0, "instances": [{"procedure_name": "spine replacement", "hospital_lat": "37.7493", "hospital_long": "-122.4570", "hospital_name": "ST. FRANCIS MEMORIAL HOSPITAL", "instance_cost": "43000.00", "id": 15}, {"procedure_name": "spine replacement", "hospital_lat": "37.7493", "hospital_long": "-122.4570", "hospital_name": "ST. FRANCIS MEMORIAL HOSPITAL", "instance_cost": "43500.00", "id": 16}], "id": 11}, {"hospital_lat": "37.7635", "hospital_long": "-122.4570", "hospital_name": "LANGLEY PORTER PSYCHIATRIC INSTITUTE", "avg_cost": 50000.0, "instances": [{"procedure_name": "spine replacement", "hospital_lat": "37.7635", "hospital_long": "-122.4570", "hospital_name": "LANGLEY PORTER PSYCHIATRIC INSTITUTE", "instance_cost": "50000.00", "id": 13}], "id": 13}, {"hospital_lat": "37.7278", "hospital_long": "-122.4310", "hospital_name": "JEWISH HOME", "avg_cost": 95000.0, "instances": [{"procedure_name": "spine replacement", "hospital_lat": "37.7278", "hospital_long": "-122.4310", "hospital_name": "JEWISH HOME", "instance_cost": "100000.00", "id": 12}, {"procedure_name": "spine replacement", "hospital_lat": "37.7278", "hospital_long": "-122.4310", "hospital_name": "JEWISH HOME", "instance_cost": "90000.00", "id": 14}], "id": 16}]};

var instances;
var oneHData;
var array = data_seed["hospitals"];
console.log(array)
for(var i=0; i<array.length; i++){
  if(array[i].hospital_name == "ST. MARY'S MEDICAL CENTER, SAN FRANCISCO"){
    instances = array[i].instances

  }
}

console.log("got instances", instances, instances.length)
var hospitalMax = instances[0].instance_cost
var hospitalMin = instances[0].instance_cost
var mycats = [];
for(var i=0; i<instances.length; i++){
  if (instances[i].instance_cost > hospitalMax) {
    hospitalMax = instances[i].instance_cost
  }
  if(instances[i].instance_cost < hospitalMin) {
    hospitalMin = parseInt(instances[i].instance_cost)
  }

}
console.log("hospital Mx", hospitalMax)
var hospitalDiff = parseInt(hospitalMax) - parseInt(hospitalMin);

var increment = Math.floor(hospitalDiff/10);
console.log(increment)
for(var j=0; j<10; j++){
  mycats.push(parseInt(hospitalMin))
  hospitalMin = parseInt(hospitalMin) + parseInt(increment)
}
console.log(mycats)
var myvalues = [0,0,0,0,0,0,0,0,0,0];
for(var k=0; k<instances.length; k++){
  var added = false
  for(var m=0; m<mycats.length-1; m++){
    var parsed = parseFloat(instances[k].instance_cost)

    if(parsed >= mycats[m] && parsed < mycats[m+1]){
      myvalues[m] += 1;
      added = true
      break;
    }

  }
  if(added == false){
    console.log("going here", m)
      myvalues[m] += 1;
  }

}
console.log(myvalues)



$(function () {
    Highcharts.chart('container', {
        chart: {
            type: 'column'
        },
        title: {
            text: "Spine replacements at St. Mary's Medical Center"
        },

        xAxis: {
            categories: mycats,
            crosshair: true
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Cost in thousands of dollars (USD)'
            }
        },
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                '<td style="padding:0"><b>{point.y:.1f} mm</b></td></tr>',
            footerFormat: '</table>',
            shared: true,
            useHTML: true
        },
        plotOptions: {
            column: {
                pointPadding: 0.2,
                borderWidth: 0
            }
        },
        series: [{
            name: "St. Mary's Medical Center",
            data: myvalues

        }]
    });
});
  </script>
</html>
